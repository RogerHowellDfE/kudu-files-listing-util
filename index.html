<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kudu Log File Listing Util</title>
</head>
<body>

<div>
    <label for="jsonFileListingInput">JSON File Listing</label><br/>
    <textarea cols="100" rows="10" id="jsonFileListingInput"></textarea>
</div>

<div>
    <label for="fileNameFilterInput">File Name Filter (regex)</label><br/>
    <input type="text" id="fileNameFilterInput"/>
</div>

<div id="outputContainer">
</div>

<script type="application/javascript">

    //
    const jsonFileListingInputElem = document.getElementById('jsonFileListingInput');
    const fileNameFilterElem = document.getElementById('fileNameFilterInput');
    const outputContainerElem = document.getElementById('outputContainer');


    //
    jsonFileListingInputElem.addEventListener('change', inputChangeHandler);
    fileNameFilterElem.addEventListener('change', inputChangeHandler);


    // Default to today's date
    const todaysDate = new Date();
    const defaultDateString = todaysDate.toISOString().split('T')[0];
    fileNameFilterElem.value = defaultDateString;


    //
    function inputChangeHandler() {
        const jsonTextInput = jsonFileListingInputElem.value;
        const fileNameFilter = fileNameFilterElem.value;

        if (jsonTextInput !== '' && fileNameFilter !== '') {
            const json = JSON.parse(jsonTextInput);

            console.info('jsonFileListingInputElem', jsonFileListingInputElem);
            console.info('json', json);
            console.info('fileNameFilter', fileNameFilter);

            updateOutput(json, fileNameFilter);
        } else {
            console.info('not all input present');
        }
    }

    //
    function updateOutput(json, fileNameFilter) {

        const filteredLogEntries = json.filter(e => e.name.includes(fileNameFilter));
        console.info('filteredLogEntries', filteredLogEntries);

        let outputHtmlString = '';

        outputHtmlString += '<ul>';
        filteredLogEntries.forEach(logEntry => {
            outputHtmlString += '<li>' + logEntry.name + '</li>';
        });
        outputHtmlString += '</ul>';

        outputContainerElem.innerHTML = outputHtmlString;
    }


    //
    inputChangeHandler();


</script>

</body>
</html>
